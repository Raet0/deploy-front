import{a as X}from"./chunk-OFFWETNE.js";import{a as Q}from"./chunk-MSH2W66A.js";import{b as L,d as B,e as R,f as O,g as j,h as z,k as G,l as H,m as Z,o as J}from"./chunk-C4LGJKLO.js";import{c as K}from"./chunk-PESOSVUV.js";import{$ as _,B as l,G as w,Ia as q,N as d,O as p,Pa as k,R as E,S as P,Sa as W,T as b,U as r,V as n,W as S,Ya as V,_ as M,a as C,b as y,ba as c,ia as o,ja as g,ka as N,ma as D,na as v,o as x,oa as f,p as A,pa as h,q as F,ta as I,v as u,z as U}from"./chunk-TYTM6227.js";var $=i=>["/programmers",i],T=(i,e)=>e.id;function ee(i,e){i&1&&(r(0,"p",7),o(1,"Cargando programadores..."),n())}function te(i,e){if(i&1){let a=M();r(0,"button",33),o(1,"Seleccionado"),n(),r(2,"button",34),_("click",function(){A(a);let m=c(3);return F(m.clearSelection())}),o(3,"Deseleccionar"),n()}}function ie(i,e){if(i&1){let a=M();r(0,"button",35),_("click",function(){A(a);let m=c().$implicit,s=c(2);return F(s.selectProgrammer(m.id))}),o(1,"Seleccionar"),n()}}function ne(i,e){if(i&1&&(r(0,"div",10)(1,"div",26),S(2,"img",27),r(3,"div")(4,"h3",28),o(5),n(),r(6,"p",29),o(7),n()()(),r(8,"div",30),d(9,te,4,0)(10,ie,2,0,"button",31),r(11,"a",32),o(12,"Ver perfil"),n()()()),i&2){let a,t=e.$implicit,m=c(2);l(2),b("src",t.photoUrl||"https://via.placeholder.com/64",U),l(3),g(t.name),l(2),g(t.specialty),l(2),p(((a=m.selectedProgrammer())==null?null:a.id)===t.id?9:10),l(2),b("routerLink",I(5,$,t.id))}}function re(i,e){i&1&&(r(0,"p",7),o(1,"No hay programadores registrados."),n())}function ae(i,e){if(i&1&&(r(0,"div",8),E(1,ne,13,7,"div",10,T,!1,re,2,0,"p",7),n()),i&2){let a=c();l(),P(a.programmers())}}function oe(i,e){i&1&&(r(0,"p",7),o(1,"Cargando disponibilidad..."),n())}function le(i,e){if(i&1&&(r(0,"div",36)(1,"p",37),o(2),n(),r(3,"p",38),o(4),n()()),i&2){let a=e.$implicit;l(2),D("",a.day," \xB7 ",a.startTime," - ",a.endTime),l(2),g(a.modality)}}function se(i,e){i&1&&(r(0,"p",7),o(1,"Selecciona un programador para ver horarios."),n())}function me(i,e){if(i&1&&E(0,le,5,4,"div",36,T,!1,se,2,0,"p",7),i&2){let a=c();P(a.availability())}}function de(i,e){if(i&1&&(r(0,"option",16),o(1),n()),i&2){let a=e.$implicit;b("value",a.id),l(),g(a.name)}}function pe(i,e){i&1&&(r(0,"p",17),o(1,"Campo obligatorio"),n())}function ue(i,e){i&1&&(r(0,"p",17),o(1,"Campo obligatorio"),n())}function ge(i,e){i&1&&(r(0,"p",17),o(1,"Campo obligatorio"),n())}function ce(i,e){i&1&&(r(0,"p",17),o(1,"Email inv\xE1lido"),n())}function _e(i,e){i&1&&(r(0,"p",17),o(1,"Campo obligatorio"),n())}function be(i,e){i&1&&S(0,"span",23)}function ve(i,e){i&1&&(r(0,"p",7),o(1,"Cargando solicitudes..."),n())}function fe(i,e){if(i&1&&(r(0,"p",41),o(1),n()),i&2){let a=c().$implicit;l(),N("Respuesta: ",a.response)}}function he(i,e){if(i&1&&(r(0,"div",39)(1,"p",37),o(2),n(),r(3,"p",38),o(4),n(),r(5,"p",40),o(6,"Estado: "),r(7,"span",37),o(8),n()(),d(9,fe,2,1,"p",41),n()),i&2){let a=e.$implicit;l(2),g(a.programmerName),l(2),g(a.scheduledAt),l(4),g(a.status),l(),p(a.response?9:-1)}}function Ce(i,e){i&1&&(r(0,"p",7),o(1,"No hay solicitudes registradas."),n())}function ye(i,e){if(i&1&&(r(0,"div",25),E(1,he,10,4,"div",39,T,!1,Ce,2,0,"p",7),n()),i&2){let a=c();l(),P(a.myAdvisories())}}var Y=class i{programmerService=x(X);toast=x(Q);route=x(k);auth=x(V);programmers=u([]);selectedProgrammer=u(null);availability=u([]);advisoryForm=u({});myAdvisories=u([]);sending=u(!1);loadingAdvisories=u(!1);loadingProgrammers=u(!1);loadingAvailability=u(!1);touched=u({programmer:!1,name:!1,email:!1,date:!1});get currentEmail(){return this.auth.currentUser()?.email}ngOnInit(){this.loadProgrammers(),this.route.queryParamMap.subscribe(e=>{let a=Number(e.get("programmerId"));a&&this.selectProgrammer(a)}),this.currentEmail&&(this.advisoryForm.update(e=>y(C({},e),{requesterEmail:this.currentEmail})),this.loadMyAdvisories())}markTouched(e){this.touched.update(a=>y(C({},a),{[e]:!0}))}loadProgrammers(){this.loadingProgrammers.set(!0),this.programmerService.listProgrammersPublic().subscribe({next:e=>{this.programmers.set(e),this.loadingProgrammers.set(!1)},error:()=>{this.toast.error("No se pudo cargar programadores"),this.loadingProgrammers.set(!1)}})}onProgrammerChange(e){if(!e){this.clearSelection();return}this.selectProgrammer(e)}selectProgrammer(e){let a=this.programmers().find(t=>t.id===e)||null;this.selectedProgrammer.set(a),this.advisoryForm.update(t=>y(C({},t),{programmerProfileId:e})),this.loadingAvailability.set(!0),this.programmerService.listAvailabilityPublic(e).subscribe({next:t=>{this.availability.set(t),this.loadingAvailability.set(!1)},error:()=>{this.availability.set([]),this.loadingAvailability.set(!1)}})}clearSelection(){this.selectedProgrammer.set(null),this.availability.set([]),this.advisoryForm.update(e=>y(C({},e),{programmerProfileId:void 0}))}submit(){let e=this.advisoryForm();if(!e.programmerProfileId||!e.scheduledAt||!e.requesterEmail||!e.requesterName){this.toast.warning("Completa programador, nombre, email y fecha");return}if(!this.isValidEmail(e.requesterEmail)){this.toast.warning("Email inv\xE1lido");return}if(!this.isFutureDate(e.scheduledAt)){this.toast.warning("La fecha debe ser futura");return}if(!this.isWithinAvailability(e.scheduledAt)){this.toast.warning("La fecha no est\xE1 dentro de la disponibilidad");return}this.sending.set(!0),this.programmerService.createAdvisory({programmerProfileId:e.programmerProfileId,requesterName:e.requesterName,requesterEmail:e.requesterEmail,scheduledAt:e.scheduledAt,comment:e.comment}).subscribe({next:()=>{this.toast.success("Solicitud enviada"),this.loadMyAdvisories(),this.advisoryForm.set({requesterEmail:e.requesterEmail,requesterName:e.requesterName}),this.clearSelection(),this.sending.set(!1)},error:a=>{this.toast.error(a?.error?.error||"No se pudo enviar"),this.sending.set(!1)}})}loadMyAdvisories(){let e=this.currentEmail||this.advisoryForm().requesterEmail;if(!e){this.toast.warning("No hay email disponible");return}this.loadingAdvisories.set(!0),this.programmerService.listAdvisoriesByRequester(e).subscribe({next:a=>{this.myAdvisories.set(a),this.loadingAdvisories.set(!1),a.length||this.toast.info("No hay solicitudes registradas")},error:()=>{this.toast.error("No se pudieron cargar tus asesor\xEDas"),this.loadingAdvisories.set(!1)}})}countStatus(e){return this.myAdvisories().filter(a=>a.status===e).length}isValidEmail(e){return e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e):!1}isFutureDate(e){return new Date(e).getTime()>Date.now()}isWithinAvailability(e){let a=new Date(e);if(isNaN(a.getTime())||!this.availability().length)return!0;let t=a.toLocaleDateString("en-US",{weekday:"long"}).toUpperCase(),m=a.toTimeString().slice(0,5);return this.availability().some(s=>s.day===t&&m>=s.startTime&&m<=s.endTime)}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=w({type:i,selectors:[["app-user-page"]],decls:70,vars:19,consts:[[1,"max-w-6xl","mx-auto","px-6","py-20","bg-base-100","text-base-content"],[1,"text-4xl","font-extrabold","mb-10","text-center"],[1,"grid","md:grid-cols-3","gap-4","mb-10"],[1,"p-4","rounded-xl","bg-base-200"],[1,"text-sm","opacity-60"],[1,"text-3xl","font-bold"],[1,"text-2xl","font-semibold","mb-4"],[1,"text-base-content/60"],[1,"grid","md:grid-cols-2","gap-8","mb-12"],[1,"border","rounded-2xl","p-6","shadow-md","bg-base-200","mb-10"],[1,"border","rounded-2xl","p-6","shadow-md","bg-base-200"],[1,"text-2xl","font-semibold","mb-6"],[1,"grid","gap-4",3,"submit"],[1,"text-sm","font-semibold"],["name","prog",1,"border","px-4","py-2","rounded-lg","bg-base-100","w-full",3,"ngModelChange","blur","ngModel"],["value",""],[3,"value"],[1,"text-error","text-xs","mt-1"],["name","name",1,"border","px-4","py-2","rounded-lg","bg-base-100","w-full",3,"ngModelChange","blur","ngModel"],["name","email",1,"border","px-4","py-2","rounded-lg","bg-base-100","w-full",3,"ngModelChange","blur","ngModel","readonly"],["type","datetime-local","name","date",1,"border","px-4","py-2","rounded-lg","bg-base-100","w-full",3,"ngModelChange","blur","ngModel"],["name","comment",1,"border","px-4","py-2","rounded-lg","bg-base-100","w-full",3,"ngModelChange","ngModel"],[1,"btn","btn-primary",3,"disabled"],[1,"loading","loading-spinner","loading-xs"],[1,"mt-12"],[1,"grid","gap-4"],[1,"flex","items-center","gap-4"],[1,"w-16","h-16","rounded-full","object-cover",3,"src"],[1,"text-xl","font-bold"],[1,"text-base-content/70"],[1,"mt-4","flex","gap-2"],[1,"btn","btn-primary","btn-sm"],[1,"btn","btn-ghost","btn-sm",3,"routerLink"],["disabled","",1,"btn","btn-success","btn-sm"],[1,"btn","btn-ghost","btn-sm",3,"click"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"border","rounded-xl","p-3","bg-base-100","mb-2"],[1,"font-semibold"],[1,"text-sm","text-base-content/60"],[1,"border","rounded-2xl","p-4","bg-base-200"],[1,"mt-2"],[1,"text-base-content/70","mt-2"]],template:function(a,t){a&1&&(S(0,"app-drawer"),r(1,"section",0)(2,"h1",1),o(3,"Agendar Asesor\xEDa"),n(),r(4,"div",2)(5,"div",3)(6,"p",4),o(7,"Pendientes"),n(),r(8,"p",5),o(9),n()(),r(10,"div",3)(11,"p",4),o(12,"Aprobadas"),n(),r(13,"p",5),o(14),n()(),r(15,"div",3)(16,"p",4),o(17,"Rechazadas"),n(),r(18,"p",5),o(19),n()()(),r(20,"h2",6),o(21,"Programadores disponibles"),n(),d(22,ee,2,0,"p",7)(23,ae,4,1,"div",8),r(24,"div",9)(25,"h2",6),o(26,"Disponibilidad"),n(),d(27,oe,2,0,"p",7)(28,me,3,1),n(),r(29,"div",10)(30,"h2",11),o(31,"Formulario de solicitud"),n(),r(32,"form",12),_("submit",function(s){return s.preventDefault(),t.submit()}),r(33,"div")(34,"label",13),o(35,"Programador *"),n(),r(36,"select",14),h("ngModelChange",function(s){return f(t.advisoryForm().programmerProfileId,s)||(t.advisoryForm().programmerProfileId=s),s}),_("ngModelChange",function(s){return t.onProgrammerChange(s)})("blur",function(){return t.markTouched("programmer")}),r(37,"option",15),o(38,"-- Selecciona programador --"),n(),E(39,de,2,2,"option",16,T),n(),d(41,pe,2,0,"p",17),n(),r(42,"div")(43,"label",13),o(44,"Tu nombre *"),n(),r(45,"input",18),h("ngModelChange",function(s){return f(t.advisoryForm().requesterName,s)||(t.advisoryForm().requesterName=s),s}),_("blur",function(){return t.markTouched("name")}),n(),d(46,ue,2,0,"p",17),n(),r(47,"div")(48,"label",13),o(49,"Tu email *"),n(),r(50,"input",19),h("ngModelChange",function(s){return f(t.advisoryForm().requesterEmail,s)||(t.advisoryForm().requesterEmail=s),s}),_("blur",function(){return t.markTouched("email")}),n(),d(51,ge,2,0,"p",17),d(52,ce,2,0,"p",17),n(),r(53,"div")(54,"label",13),o(55,"Fecha y hora *"),n(),r(56,"input",20),h("ngModelChange",function(s){return f(t.advisoryForm().scheduledAt,s)||(t.advisoryForm().scheduledAt=s),s}),_("blur",function(){return t.markTouched("date")}),n(),d(57,_e,2,0,"p",17),n(),r(58,"div")(59,"label",13),o(60,"Comentario (opcional)"),n(),r(61,"textarea",21),h("ngModelChange",function(s){return f(t.advisoryForm().comment,s)||(t.advisoryForm().comment=s),s}),n()(),r(62,"button",22),d(63,be,1,0,"span",23),o(64," Enviar solicitud "),n()()(),r(65,"div",24)(66,"h2",6),o(67,"Mis solicitudes"),n(),d(68,ve,2,0,"p",7)(69,ye,4,1,"div",25),n()()),a&2&&(l(9),g(t.countStatus("PENDIENTE")),l(5),g(t.countStatus("APROBADA")),l(5),g(t.countStatus("RECHAZADA")),l(3),p(t.loadingProgrammers()?22:23),l(5),p(t.loadingAvailability()?27:28),l(9),v("ngModel",t.advisoryForm().programmerProfileId),l(3),P(t.programmers()),l(2),p(t.touched().programmer&&!t.advisoryForm().programmerProfileId?41:-1),l(4),v("ngModel",t.advisoryForm().requesterName),l(),p(t.touched().name&&!t.advisoryForm().requesterName?46:-1),l(4),v("ngModel",t.advisoryForm().requesterEmail),b("readonly",t.currentEmail),l(),p(t.touched().email&&!t.advisoryForm().requesterEmail?51:-1),l(),p(t.touched().email&&t.advisoryForm().requesterEmail&&!t.isValidEmail(t.advisoryForm().requesterEmail)?52:-1),l(4),v("ngModel",t.advisoryForm().scheduledAt),l(),p(t.touched().date&&!t.advisoryForm().scheduledAt?57:-1),l(4),v("ngModel",t.advisoryForm().comment),l(),b("disabled",t.sending()),l(),p(t.sending()?63:-1),l(5),p(t.loadingAdvisories()?68:69))},dependencies:[q,J,z,H,Z,L,G,B,R,j,O,W,K],encapsulation:2})};export{Y as UserPageComponent};
