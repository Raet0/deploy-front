<div class="dropdown dropdown-end">
  <button tabindex="0" class="btn btn-ghost btn-circle indicator" type="button">
    @if (notificationsService.notificationCount() > 0) {
      <span class="indicator-item badge badge-primary badge-sm">
        {{ notificationsService.notificationCount() }}
      </span>
    }
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
    </svg>
  </button>

  <div tabindex="0" class="dropdown-content z-[1] card card-compact w-96 bg-base-100 shadow">
    <div class="card-body p-0 flex flex-col h-full">
      <!-- Header -->
      <div class="p-4 border-b border-base-300">
        <span class="card-title text-lg">Notificaciones</span>
      </div>

      <!-- Notificaciones -->
      @if (notificationsService.notifications().length === 0) {
        <p class="text-center text-base-content/60 py-8">No hay notificaciones</p>
      } @else {
        <div class="max-h-96 overflow-y-auto">
          @for (notification of notificationsService.notifications(); track notification.id) {
            <div class="mb-2 p-3 bg-base-200 hover:bg-base-300 transition rounded flex justify-between items-start gap-2">
              <div class="flex-1">
                <p class="font-semibold text-sm">{{ notification.title }}</p>
                <p class="text-xs text-base-content/70">{{ notification.message }}</p>
                <p class="text-xs text-base-content/50 mt-1">{{ notification.createdAt | date: 'short' }}</p>
              </div>

              <!-- Botón de visto (✓) -->
              <button
                (click)="markAsRead(notification.id)"
                class="btn btn-ghost btn-xs rounded-full hover:bg-success/20"
                title="Marcar como leído">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-success" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
              </button>
            </div>
          }
        </div>
      }

      <!-- Footer con botón "Ver todas" -->
      <div class="border-t border-base-300 p-3 mt-auto">
        <button
          (click)="goToAllNotifications()"
          class="btn btn-sm btn-primary w-full">
          Ver todas las notificaciones
        </button>
      </div>
    </div>
  </div>
</div>
