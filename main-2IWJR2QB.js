import{a as j}from"./chunk-YEPPDUEW.js";import{b as k,d as R,g as L,o as B}from"./chunk-7NOJ4FLA.js";import{a as O,b as ge,c as xe}from"./chunk-Z4WB5FUE.js";import{$ as h,B as l,Ea as se,G as E,Ha as ce,Ia as w,Ja as de,N as x,Na as me,O as _,Oa as pe,Qa as fe,R as I,Ra as y,S as A,T as C,U as o,Ua as ue,V as n,Va as D,W as v,X as P,Y as T,Ya as b,_ as S,a as Y,aa as ne,b as ee,ba as c,ga as oe,ha as ae,ia as r,ja as p,ka as N,na as U,o as d,oa as F,p as f,pa as V,q as u,qa as re,u as te,ua as J,v as g,wa as q,xa as le,z as ie}from"./chunk-DDCXKO4N.js";var M=async()=>{let t=d(y),i=d(b);return await i.waitForAuth(),i.currentUser()?!0:(t.navigate(["/login"]),!1)};var Z=async()=>{let t=d(y),i=d(b);await i.waitForAuth();let e=i.currentUser();if(!e)return!0;switch(e.role){case"admin":t.navigate(["/admin"]);break;case"programmer":t.navigate(["/programmer"]);break;default:t.navigate(["/user"])}return!1};var W=t=>async()=>{let i=d(y),e=d(b);await e.waitForAuth();let a=e.currentUser();return a?t.includes(a.role)?!0:(i.navigate(["/user"]),!1):(i.navigate(["/login"]),!1)};function Se(t,i){t&1&&(o(0,"p",22),r(1,"Subiendo foto..."),n())}function Ne(t,i){t&1&&v(0,"span",24)}function Pe(t,i){if(t&1){let e=S();o(0,"div",16)(1,"div")(2,"label",17),r(3,"Nombre *"),n(),o(4,"input",18),V("ngModelChange",function(s){f(e);let m=c(2);return F(m.form().name,s)||(m.form().name=s),u(s)}),n()(),o(5,"div")(6,"label",17),r(7,"Titular"),n(),o(8,"input",19),V("ngModelChange",function(s){f(e);let m=c(2);return F(m.form().headline,s)||(m.form().headline=s),u(s)}),n()(),o(9,"div")(10,"label",17),r(11,"Biograf\xEDa"),n(),o(12,"textarea",20),V("ngModelChange",function(s){f(e);let m=c(2);return F(m.form().bio,s)||(m.form().bio=s),u(s)}),n()(),o(13,"div")(14,"label",17),r(15,"Foto de perfil"),n(),o(16,"input",21),h("change",function(s){f(e);let m=c(2);return u(m.onFileSelected(s))}),n(),x(17,Se,2,0,"p",22),n(),o(18,"button",23),h("click",function(){f(e);let s=c(2);return u(s.saveProfile())}),x(19,Ne,1,0,"span",24),r(20," Guardar cambios "),n()()}if(t&2){let e=c(2);l(4),U("ngModel",e.form().name),l(4),U("ngModel",e.form().headline),l(4),U("ngModel",e.form().bio),l(5),_(e.uploading()?17:-1),l(),C("disabled",e.saving()),l(),_(e.saving()?19:-1)}}function we(t,i){if(t&1&&(o(0,"div",25)(1,"div",26)(2,"p",27),r(3,"Estado"),n(),o(4,"p",28),r(5,"Activo"),n()(),o(6,"div",26)(7,"p",27),r(8,"Miembro desde"),n(),o(9,"p",28),r(10),n()(),o(11,"div",26)(12,"p",27),r(13,"Rol"),n(),o(14,"p",28),r(15),n()()(),o(16,"div",29)(17,"h2",30),r(18,"Sobre m\xED"),n(),o(19,"p",31),r(20),n()(),o(21,"div",32)(22,"div",26)(23,"h3",33),r(24,"Contacto"),n(),o(25,"p",11),r(26),n()(),o(27,"div",26)(28,"h3",33),r(29,"Titular"),n(),o(30,"p",11),r(31),n()()()),t&2){let e=c(2);l(10),p(e.formatDate(e.profile().createdAt)),l(5),p(e.roleLabel(e.profile().role)),l(5),p(e.profile().bio||"Sin biograf\xEDa todav\xEDa."),l(6),N("Email: ",e.profile().email),l(5),p(e.profile().headline||"Sin titular")}}function ye(t,i){if(t&1){let e=S();o(0,"div",1),v(1,"div",3),o(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7)(6,"div",8),v(7,"img",9),n()(),o(8,"div")(9,"h1",10),r(10),n(),o(11,"p",11),r(12),n(),o(13,"div",12)(14,"span",13),r(15),n(),o(16,"button",14),h("click",function(){f(e);let s=c();return u(s.toggleEdit())}),r(17),n(),o(18,"button",15),h("click",function(){f(e);let s=c();return u(s.copyProfile())}),r(19,"Compartir"),n()()()()(),x(20,Pe,21,6,"div",16)(21,we,32,5),n()()}if(t&2){let e=c();l(7),C("src",e.form().photoUrl||"https://ui-avatars.com/api/?name="+e.profile().name+"&background=0D9488&color=fff&size=128",ie),l(3),p(e.profile().name),l(2),p(e.profile().email),l(2),C("ngClass",e.roleBadge(e.profile().role)),l(),N(" ",e.roleLabel(e.profile().role)," "),l(2),N(" ",e.editing()?"Cancelar":"Editar perfil"," "),l(3),_(e.editing()?20:21)}}function Te(t,i){t&1&&(o(0,"div",2),r(1,"Cargando perfil..."),n())}var z=class t{userService=d(O);toast=d(j);profile=g(null);editing=g(!1);saving=g(!1);uploading=g(!1);form=g({name:"",headline:"",bio:"",photoUrl:""});ngOnInit(){this.loadProfile()}loadProfile(){this.userService.getMyProfile().subscribe({next:i=>{this.profile.set(i),this.form.set({name:i.name||"",headline:i.headline||"",bio:i.bio||"",photoUrl:i.photoUrl||""})},error:()=>this.toast.error("No se pudo cargar el perfil")})}roleLabel(i){switch(i){case"admin":return"Administrador";case"programmer":return"Programador";default:return"Usuario"}}roleBadge(i){switch(i){case"admin":return"badge-primary";case"programmer":return"badge-secondary";default:return"badge-outline"}}formatDate(i){if(!i)return"\u2014";let e=new Date(i);return new Intl.DateTimeFormat("es-EC",{dateStyle:"medium"}).format(e)}toggleEdit(){this.editing.set(!this.editing())}saveProfile(){let i=this.form();if(!i.name){this.toast.warning("El nombre es obligatorio");return}this.saving.set(!0),this.userService.updateMyProfile({name:i.name,headline:i.headline,bio:i.bio,photoUrl:i.photoUrl}).subscribe({next:e=>{this.profile.set(e),this.toast.success("Perfil actualizado"),this.saving.set(!1),this.editing.set(!1)},error:e=>{this.toast.error(e?.error?.error||"No se pudo actualizar"),this.saving.set(!1)}})}async onFileSelected(i){let e=i.target;if(!e.files?.length)return;let a=e.files[0];if(!D.cloudinaryCloudName||!D.cloudinaryUploadPreset){this.toast.error("Configura Cloudinary en environments");return}this.uploading.set(!0);let s=new FormData;s.append("file",a),s.append("upload_preset",D.cloudinaryUploadPreset);try{let X=await(await fetch(`https://api.cloudinary.com/v1_1/${D.cloudinaryCloudName}/image/upload`,{method:"POST",body:s})).json();X?.secure_url?(this.form.update(be=>ee(Y({},be),{photoUrl:X.secure_url})),this.toast.success("Foto subida")):this.toast.error("Error subiendo foto")}catch{this.toast.error("Error subiendo foto")}finally{this.uploading.set(!1)}}copyProfile(){navigator.clipboard.writeText(window.location.href).then(()=>this.toast.success("Perfil copiado")).catch(()=>this.toast.warning("No se pudo copiar"))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=E({type:t,selectors:[["app-user-profile"]],decls:4,vars:1,consts:[[1,"max-w-5xl","mx-auto","px-6","py-20","text-base-content"],[1,"bg-base-200","rounded-3xl","shadow-xl","overflow-hidden"],[1,"text-center","opacity-70"],[1,"h-40","bg-gradient-to-r","from-primary/80","to-secondary/80"],[1,"px-8","pb-8"],[1,"-mt-12","flex","flex-col","md:flex-row","md:items-center","md:justify-between","gap-4"],[1,"flex","items-center","gap-4"],[1,"avatar","border-4","border-base-100","rounded-full","shadow-lg"],[1,"w-24","rounded-full"],["alt","Avatar",3,"src"],[1,"text-3xl","font-bold"],[1,"text-sm","opacity-70"],[1,"flex","items-center","gap-2","mt-2"],[1,"badge",3,"ngClass"],[1,"btn","btn-outline","btn-xs",3,"click"],[1,"btn","btn-primary","btn-xs",3,"click"],[1,"mt-8","grid","gap-4"],[1,"text-sm","font-semibold"],["name","name",1,"border","px-4","py-2","rounded-lg","bg-base-100","w-full",3,"ngModelChange","ngModel"],["name","headline",1,"border","px-4","py-2","rounded-lg","bg-base-100","w-full",3,"ngModelChange","ngModel"],["name","bio",1,"border","px-4","py-2","rounded-lg","bg-base-100","w-full",3,"ngModelChange","ngModel"],["type","file",1,"file-input","file-input-bordered","w-full",3,"change"],[1,"text-xs","mt-1","opacity-60"],[1,"btn","btn-primary","w-fit",3,"click","disabled"],[1,"loading","loading-spinner","loading-xs"],[1,"mt-8","grid","md:grid-cols-3","gap-4"],[1,"p-4","rounded-xl","bg-base-100","shadow"],[1,"text-xs","uppercase","opacity-60"],[1,"font-semibold"],[1,"mt-8"],[1,"text-xl","font-semibold","mb-3"],[1,"opacity-80"],[1,"mt-10","grid","md:grid-cols-2","gap-4"],[1,"font-semibold","mb-2"]],template:function(e,a){e&1&&(v(0,"app-drawer"),o(1,"section",0),x(2,ye,22,7,"div",1)(3,Te,2,0,"div",2),n()),e&2&&(l(2),_(a.profile()?2:3))},dependencies:[w,se,B,k,R,L,xe],encapsulation:2,changeDetection:0})};var De=(t,i)=>i.id;function Me(t,i){t&1&&(o(0,"p",5),r(1,"No hay notificaciones"),n())}function Ie(t,i){if(t&1){let e=S();o(0,"div",10),h("click",function(){let s=f(e).$implicit,m=c(2);return u(m.selectNotification(s))}),o(1,"p",11),r(2),n(),o(3,"p",12),r(4),n(),o(5,"div",13)(6,"span",14),r(7),J(8,"date"),n(),o(9,"span",15),r(10),n()()()}if(t&2){let e,a=i.$implicit,s=c(2);oe("bg-primary/20",((e=s.selectedNotification())==null?null:e.id)===a.id),l(2),p(a.title),l(2),p(a.message),l(3),p(q(8,7,a.createdAt,"short")),l(2),C("className",a.status==="PENDIENTE"?"badge-warning":a.status==="APROBADA"?"badge-success":"badge-error"),l(),N(" ",a.status," ")}}function Ae(t,i){if(t&1&&I(0,Ie,11,10,"div",9,De),t&2){let e=c();A(e.allNotifications())}}function Ue(t,i){t&1&&v(0,"span",28)}function Fe(t,i){if(t&1){let e=S();o(0,"div")(1,"label",22)(2,"div",23)(3,"span",24),r(4,"Tu respuesta"),n()(),o(5,"textarea",25),h("ngModelChange",function(s){f(e);let m=c(2);return u(m.responseText.set(s))}),n()()(),o(6,"div",26)(7,"button",27),h("click",function(){f(e);let s=c(2);return u(s.respondToNotification())}),x(8,Ue,1,0,"span",28),r(9," Enviar respuesta "),n(),o(10,"button",29),h("click",function(){f(e);let s=c(2);return u(s.deleteNotification(s.selectedNotification().id))}),r(11," Descartar "),n()()}if(t&2){let e=c(2);l(5),C("ngModel",e.responseText()),l(2),C("disabled",e.isLoading()),l(),_(e.isLoading()?8:-1)}}function Ve(t,i){t&1&&(o(0,"p",5),r(1,"No hay acciones disponibles"),n())}function ke(t,i){if(t&1&&(o(0,"div",7)(1,"div",16)(2,"h3",17),r(3),n(),o(4,"p",18),r(5),n(),v(6,"div",19),o(7,"div",20)(8,"div")(9,"p",21),r(10,"Estado"),n(),o(11,"span",15),r(12),n()(),o(13,"div")(14,"p",21),r(15,"Fecha"),n(),o(16,"p"),r(17),J(18,"date"),n()()(),v(19,"div",19),x(20,Fe,12,3)(21,Ve,2,0,"p",5),n()()),t&2){let e,a=c();l(3),p(a.selectedNotification().title),l(2),p(a.selectedNotification().message),l(6),C("className",a.selectedNotification().status==="PENDIENTE"?"badge-warning":a.selectedNotification().status==="APROBADA"?"badge-success":"badge-error"),l(),N(" ",a.selectedNotification().status," "),l(5),p(q(18,6,a.selectedNotification().createdAt,"medium")),l(3),_(((e=a.authService.currentUser())==null?null:e.role)==="programmer"&&a.selectedNotification().status==="PENDIENTE"?20:21)}}function Re(t,i){t&1&&(o(0,"div",8)(1,"p",30),r(2,"Selecciona una notificaci\xF3n para ver detalles"),n()())}var G=class t{authService=d(b);notificationsService=d(ge);allNotifications=g([]);selectedNotification=g(null);responseText=g("");isLoading=g(!1);ngOnInit(){let i=this.authService.currentUser();i&&(this.notificationsService.loadNotifications(i.email,i.role),this.allNotifications.set(this.notificationsService.notifications()))}selectNotification(i){this.selectedNotification.set(i),this.responseText.set("")}respondToNotification(){let i=this.selectedNotification();if(!i||!this.responseText()){alert("Por favor escribe una respuesta");return}this.isLoading.set(!0),console.log("Respuesta enviada:",{notificationId:i.id,response:this.responseText(),status:i.status==="PENDIENTE"?"APROBADA":i.status}),setTimeout(()=>{this.isLoading.set(!1),alert("Respuesta enviada"),this.selectedNotification.set(null),this.responseText.set("")},1e3)}deleteNotification(i){let e=this.allNotifications();this.allNotifications.set(e.filter(a=>a.id!==i))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=E({type:t,selectors:[["app-notifications-page"]],decls:11,vars:2,consts:[[1,"min-h-screen","bg-base-100","p-6"],[1,"max-w-6xl","mx-auto","grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-1"],[1,"text-2xl","font-bold","mb-4"],[1,"space-y-2","max-h-96","overflow-y-auto"],[1,"text-center","text-base-content/60","py-6"],[1,"lg:col-span-2"],[1,"card","bg-base-200","shadow-lg"],[1,"text-center","text-base-content/60","py-12"],[1,"p-4","bg-base-200","hover:bg-base-300","cursor-pointer","rounded-lg","transition",3,"bg-primary/20"],[1,"p-4","bg-base-200","hover:bg-base-300","cursor-pointer","rounded-lg","transition",3,"click"],[1,"font-semibold","text-sm"],[1,"text-xs","text-base-content/70","mt-1"],[1,"flex","justify-between","items-center","mt-2"],[1,"text-xs","text-base-content/50"],[1,"badge",3,"className"],[1,"card-body"],[1,"card-title","text-xl"],[1,"text-base-content/80"],[1,"divider"],[1,"grid","grid-cols-2","gap-4","text-sm"],[1,"opacity-60"],[1,"form-control","w-full"],[1,"label"],[1,"label-text","font-semibold"],["placeholder","Escribe tu respuesta aqu\xED...",1,"textarea","textarea-bordered","h-24",3,"ngModelChange","ngModel"],[1,"card-actions","justify-end","mt-4"],[1,"btn","btn-primary",3,"click","disabled"],[1,"loading","loading-spinner"],[1,"btn","btn-ghost",3,"click"],[1,"text-lg"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),r(4,"Notificaciones"),n(),o(5,"div",4),x(6,Me,2,0,"p",5)(7,Ae,2,0),n()(),o(8,"div",6),x(9,ke,22,9,"div",7)(10,Re,3,0,"div",8),n()()()),e&2&&(l(6),_(a.allNotifications().length===0?6:7),l(3),_(a.selectedNotification()?9:10))},dependencies:[w,B,k,R,L,ce],encapsulation:2})};var _e=[{path:"",loadComponent:()=>import("./chunk-26TZ6OO2.js").then(t=>t.Landing)},{path:"profiles",loadComponent:()=>import("./chunk-SXY4LMS5.js").then(t=>t.Profiles)},{path:"programmers/:id",loadComponent:()=>import("./chunk-OSXIQRHM.js").then(t=>t.ProgrammerProfilePage)},{path:"login",loadComponent:()=>import("./chunk-SAGICFJG.js").then(t=>t.LoginPage),canActivate:[Z]},{path:"register",loadComponent:()=>import("./chunk-T4W7W3OX.js").then(t=>t.RegisterPage),canActivate:[Z]},{path:"admin",canActivate:[M,W(["admin"])],loadComponent:()=>import("./chunk-V62CM6F2.js").then(t=>t.AdminPageComponent)},{path:"programmer",canActivate:[M,W(["programmer"])],loadComponent:()=>import("./chunk-7JVVKUZ6.js").then(t=>t.ProgrammerPage)},{path:"user",canActivate:[M,W(["user"])],loadComponent:()=>import("./chunk-Z74ZTC2L.js").then(t=>t.UserPageComponent)},{path:"profile",component:z},{path:"notifications",component:G,canActivate:[M]},{path:"**",redirectTo:""}];var ve=(t,i)=>{let e=localStorage.getItem("auth_user"),a=e?JSON.parse(e).token:null;if(a){let s=t.clone({setHeaders:{Authorization:`Bearer ${a}`}});return i(s)}return i(t)};var he={providers:[te(),le(),ue(_e),me(pe([ve]))]};var Le=(t,i)=>i.id;function Be(t,i){if(t&1&&(P(0,"span",3),r(1),T()),t&2){let e=c().$implicit;l(),p(e.title)}}function Oe(t,i){if(t&1){let e=S();P(0,"div")(1,"div",2),x(2,Be,2,1,"span",3),P(3,"span",4),r(4),T()(),P(5,"button",5),ne("click",function(){let s=f(e).$implicit,m=c();return u(m.toast.remove(s.id))}),r(6,"\u2715"),T()()}if(t&2){let e=i.$implicit,a=c();ae(re("alert shadow-xl w-80 border border-base-300 animate-[fadeIn_0.2s_ease] ",a.getClass(e.type))),l(2),_(e.title?2:-1),l(2),p(e.message)}}var H=class t{toast=d(j);getClass(i){switch(i){case"success":return"alert-success";case"error":return"alert-error";case"warning":return"alert-warning";default:return"alert-info"}}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=E({type:t,selectors:[["app-toast"]],decls:3,vars:0,consts:[[1,"fixed","top-6","right-6","z-[999]","flex","flex-col","gap-3"],[3,"class"],[1,"flex","flex-col"],[1,"font-bold"],[1,"text-sm"],[1,"btn","btn-xs","btn-ghost",3,"click"]],template:function(e,a){e&1&&(P(0,"div",0),I(1,Oe,7,5,"div",1,Le),T()),e&2&&(l(),A(a.toast.toasts()))},dependencies:[w],encapsulation:2,changeDetection:0})};var $=class t{auth=d(b);userService=d(O);title=g("TrabajoInterciclo-PortafolioWebCompartido");isInitialized=g(!1);async ngOnInit(){await this.auth.waitForAuth(),this.userService.userProfile(),this.isInitialized.set(!0)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=E({type:t,selectors:[["app-root"]],decls:3,vars:0,template:function(e,a){e&1&&(o(0,"main"),v(1,"router-outlet")(2,"app-toast"),n())},dependencies:[fe,H],encapsulation:2})};de($,he).catch(t=>console.error(t));
