<app-drawer></app-drawer>

@if (loading()) {
  <div class="min-h-screen flex items-center justify-center">
    <span class="loading loading-spinner loading-lg"></span>
  </div>
} @else if (error()) {
  <div class="min-h-screen flex items-center justify-center">
    <p class="text-error">{{ error() }}</p>
  </div>
} @else if (profile(); as p) {
  <section class="max-w-5xl mx-auto px-6 py-16 bg-base-100">

    <!-- Header con foto y datos -->
    <div class="flex flex-col md:flex-row gap-8 items-center md:items-start mb-12">
      <div class="avatar">
        <div class="w-48 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
          <img [src]="p.photoUrl || 'https://ui-avatars.com/api/?name=' + p.name + '&background=random&size=200'" />
        </div>
      </div>

      <div class="flex-1 text-center md:text-left">
        <h1 class="text-4xl font-bold mb-2">{{ p.name }}</h1>
        <p class="text-xl text-primary font-semibold mb-4">{{ p.specialty }}</p>
        <p class="text-base-content/80">{{ p.description }}</p>

        <!-- Redes sociales -->
        @if (p.socials && p.socials.length > 0) {
          <div class="mt-6">
            <h3 class="font-semibold mb-3">Contacto:</h3>
            <div class="flex flex-wrap gap-3">
              @for (social of p.socials; track $index) {
                @if (social.name === 'whatsapp') {
                  <button
                    (click)="openWhatsApp(social.url)"
                    class="btn btn-success gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/>
                    </svg>
                    WhatsApp
                  </button>
                } @else if (social.name === 'email') {
                  <button
                    (click)="openEmail(social.url)"
                    class="btn btn-info gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    Email
                  </button>
                } @else {
                  <a
                    [href]="social.url"
                    target="_blank"
                    class="btn btn-outline gap-2">
                    {{ getSocialIcon(social.name) }} {{ social.name | titlecase }}
                  </a>
                }
              }
            </div>
          </div>
        }

        <!-- Botón agendar asesoría -->
        @if (canSchedule()) {
          <div class="mt-6">
            <a [routerLink]="['/user']" class="btn btn-primary btn-lg">
              Agendar Asesoría
            </a>
          </div>
        }
      </div>
    </div>

    <!-- Proyectos -->
    @if (projects().length > 0) {
      <div class="mb-12">
        <h2 class="text-3xl font-bold mb-6">Proyectos</h2>
        <div class="grid md:grid-cols-2 gap-6">
          @for (project of projects(); track project.id) {
            <div class="card bg-base-200 shadow-xl">
              @if (project.imageUrl) {
                <figure>
                  <img [src]="project.imageUrl" [alt]="project.name" class="w-full h-48 object-cover" />
                </figure>
              }
              <div class="card-body">
                <h3 class="card-title">{{ project.name }}</h3>
                <p class="text-base-content/70">{{ project.description }}</p>
                <div class="flex flex-wrap gap-2 mt-2">
                  @for (tech of project.technologies; track tech) {
                    <span class="badge badge-primary">{{ tech }}</span>
                  }
                </div>
                <div class="card-actions justify-end mt-4">
                  @if (project.repoUrl) {
                    <a [href]="project.repoUrl" target="_blank" class="btn btn-sm btn-outline">
                      GitHub
                    </a>
                  }
                  @if (project.demoUrl) {
                    <a [href]="project.demoUrl" target="_blank" class="btn btn-sm btn-primary">
                      Demo
                    </a>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- Disponibilidad -->
    @if (availability().length > 0) {
      <div>
        <h2 class="text-3xl font-bold mb-6">Disponibilidad</h2>
        <div class="grid md:grid-cols-2 gap-4">
          @for (slot of availability(); track slot.id) {
            <div class="card bg-base-200">
              <div class="card-body">
                <h3 class="font-semibold">{{ slot.day }}</h3>
                <p>{{ slot.startTime }} - {{ slot.endTime }}</p>
                <span class="badge badge-primary">{{ slot.modality }}</span>
              </div>
            </div>
          }
        </div>
      </div>
    }

  </section>
}
